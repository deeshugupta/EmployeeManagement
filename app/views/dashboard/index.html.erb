<% if is_admin %>
    | <%= link_to "Manage Roles", {:controller => 'roles'}, :class => 'navbar-link' %>
<% end %>
<br/><br/>
<br/><button type="button" class="tab_button" name="pending_requests">View My Pending Requests</button>

<button type="button" class="tab_button" name="new_request">Submit New Request</button>

<% if current_user.roles.include?(Role.find_by_name(:manager)) %>
    <button type="button" class="tab_button" name="see_requests">Pending Approvals</button>
    <button type="button" class="tab_button" name="member_info">View all Members</button>
<% end %>

<% if current_user.roles.include?(Role.find_by_name(:Admin)) %>
    <%= link_to "Create new user", {action: 'new'}  %>
<% end %>

<%= image_tag "search_glass.png", :class => "tab_button", :name => "search_request"%>
<br/>
<br/>
<br/>

<div id="pending_requests" class="content_section" style="display: none;">
  <table>
    <tr>
      <td>
        From Date
      </td>
      <td>
        To Date
      </td>
      <td>
        Leave Type
      </td>
      <td>
        Status
      </td>
      <td>
        Actions
      </td>
    </tr>
    <% current_user.attendances.each do |attendance|%>
        <tr>
          <td>
            <%= date_format(attendance.start_date) %>
          </td>
          <td>
            <%= date_format(attendance.end_date) %>
          </td>
          <td>
            <%= attendance.is_leave_or_wfh ? "Leave" : "Work From Home" %>
          </td>
          <td>
            <%= attendance_current_status(attendance) %>
          </td>
          <td>
            <%= link_to("show",{:controller => 'attendances', :action => 'show', :id => attendance.id},:class=>"actions")%>
            <% if(attendance_current_status(attendance).equal?(:pending))%>
            <%=link_to("edit", {:controller => 'attendances', :action => 'edit', :id => attendance.id},:class=>"actions") %>
            <%=link_to("delete", {:controller => 'attendances', :action => 'destroy', :id => attendance.id},:method=> :delete,:class=>"actions") %>
          <% end %>
                </td>
        </tr>
    <% end %>
  </table>
</div>

<div id="new_request" class="content_section" style="display: none;">
  <%= form_for(@attendance, :url => 'attendances') do |f| %>
      <%= render :partial => 'attendances/form', :locals =>  {:f =>f} %>
  <%end%>
</div>

<div id="see_requests" class="content_section" style="display: none;">
  <% if current_user.roles.include?(Role.find_by_name(:manager)) %>
      <%= render(:partial => 'attendance_show', :locals => {:attendances => current_user.approvals.where(approval_status: nil)}) %>
  <% end %>
</div>


<div class="content_section" id="search_request" style="display: none;">
  <div>
 <% if current_user.roles.include?(Role.find_by_name(:manager)) %>
  <%= form_tag("dashboard/search",:remote => true,:id=>"search_form") do %>
      <%= label_tag "User: " %><%= text_field_tag :name  %><br>
          <%= label_tag "Start Date: " %><%= date_select(:start,:start_date) %>
          <%= label_tag "End Date: " %><%=date_select(:end,:end_date) %><br>
          <%= label_tag "Status: " %><br/>
          <%= check_box_tag :pending %><%= label_tag "pending " %>
          <%= check_box_tag :approved %><%= label_tag "approved " %>
          <%= check_box_tag :rejected %><%= label_tag "rejected " %><br/>
          <%= label_tag "Leave Type: " %><br/>
          <%= check_box_tag :leave %><%= label_tag "Leave " %>
          <%= check_box_tag :wfh %><%= label_tag "Work From Home " %><br/>
          <%= submit_tag("search")%>

      <%end%>
  <% end %>
  </div>
  <div id="search_results">

  </div>
  <span id="search_results_count" style="display: block;"></span>
</div>

<div class="content_section" id="member_info" style="display: none;">
    
</div>


<script>
  $(document).ready(function() {
      attach_Click_event();
  })
</script>